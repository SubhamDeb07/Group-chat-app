<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShutApp</title>
</head>
<body>
    <form onsubmit="Send(event)" class="style-form" id ="chat-form" action="POST">
        <input type="text" name="message" placeholder="Type something ...." autocomplete="off">
        <input type="submit" value="send" >
    </form>
    
</body>
</html>
<ul id="Chats"></ul>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.2/axios.min.js"></script>
<script>
    function Send(event){

        event.preventDefault();
        const message = event.target.message.value;

        const obj = {
            message
        }
        const token = localStorage.getItem('token');
       
         axios.post("http://localhost:3000/users/addChats", obj, {headers:{"Authorization" : token}})
        .then((response)=>{
            console.log(response);
            DisplayOnScreen(response.data.message)
        }).catch(err=>console.log(err));
   
    }


   async function getChats(event){
        const token = localStorage.getItem('token');
        
       await axios.get("http://localhost:3000/users/getChats", {headers:{"Authorization" : token}})
        .then((response)=>{
                console.log(response)
                for(i=0;i<response.data.length;i++){
                    DisplayOnScreen(response.data[i])
                }
            })
            .catch((err)=>{
                console.log(err)
            })
   }


    function DisplayOnScreen(user){
            const parentNode = document.getElementById("Chats")
            const childNode = `<li id=${user.id}>${user.username}- ${user.message}</li>`
            parentNode.innerHTML = parentNode.innerHTML + childNode
        
        }

    
let interValid = setInterval(getChats, 5000)
if(interValid){
    clearInterval(interValid)
}
    


window.addEventListener('DOMContentLoaded', getChats())






</script>